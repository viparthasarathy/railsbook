<% if current_user.friends.include?(@user) %>
  <% if current_user.initiated_friendships.include?(@user) %>
    <%= form_for(current_user.friend_requests.find_by(:friend_id => @user[:id]), :html => { :method => :delete }) do |f| %>
      <%= f.submit "Remove Friend" %>
    <% end %>

  <% else %>
    <%= form_for(@user.friend_requests.find_by(:friend_id => current_user[:id]), :html => { :method => :delete }) do |f| %>
      <%= f.submit "Remove Friend" %>
    <% end %>
  <% end %>

<% elsif current_user.requesting_friendships.include?(@user) %>
  <%= form_for(@user.friend_requests.find_by(:friend_id => current_user[:id]), :html => { :method => :put }) do |f| %> 
    <%= f.submit "Accept Request" %>
  <% end %>
  <%= form_for(@user.friend_requests.find_by(:friend_id => current_user[:id]), :html => { :method => :delete }) do |f| %>
    <%= f.submit "Decline Request" %>
  <% end %>
<% elsif current_user.pending_friendships.include?(@user) %>
  <%= form_for(current_user.friend_requests.find_by(:friend_id => @user[:id]), :html => { :method => :delete }) do |f| %>
    <%= f.submit "Cancel Request" %>
  <% end %>

<% else %>
  <%= form_for(current_user.friend_requests.build) do |f| %>
    <%= f.hidden_field :friend_id, :value => @user[:id] %>
    <%= f.submit "Add Friend" %>
  <% end %>

<% end %>